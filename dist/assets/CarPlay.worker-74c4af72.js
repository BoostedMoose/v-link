var xr=Object.defineProperty;var gr=(C,E,O)=>E in C?xr(C,E,{enumerable:!0,configurable:!0,writable:!0,value:O}):C[E]=O;var w=(C,E,O)=>(gr(C,typeof E!="symbol"?E+"":E,O),O);(function(){"use strict";function C(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var E={},O={};O.byteLength=ue,O.toByteArray=fe,O.fromByteArray=de;for(var T=[],R=[],se=typeof Uint8Array<"u"?Uint8Array:Array,ut="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=0,ce=ut.length;q<ce;++q)T[q]=ut[q],R[ut.charCodeAt(q)]=q;R["-".charCodeAt(0)]=62,R["_".charCodeAt(0)]=63;function It(r){var s=r.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=r.indexOf("=");o===-1&&(o=s);var c=o===s?0:4-o%4;return[o,c]}function ue(r){var s=It(r),o=s[0],c=s[1];return(o+c)*3/4-c}function ae(r,s,o){return(s+o)*3/4-o}function fe(r){var s,o=It(r),c=o[0],f=o[1],d=new se(ae(r,c,f)),l=0,u=f>0?c-4:c,y;for(y=0;y<u;y+=4)s=R[r.charCodeAt(y)]<<18|R[r.charCodeAt(y+1)]<<12|R[r.charCodeAt(y+2)]<<6|R[r.charCodeAt(y+3)],d[l++]=s>>16&255,d[l++]=s>>8&255,d[l++]=s&255;return f===2&&(s=R[r.charCodeAt(y)]<<2|R[r.charCodeAt(y+1)]>>4,d[l++]=s&255),f===1&&(s=R[r.charCodeAt(y)]<<10|R[r.charCodeAt(y+1)]<<4|R[r.charCodeAt(y+2)]>>2,d[l++]=s>>8&255,d[l++]=s&255),d}function he(r){return T[r>>18&63]+T[r>>12&63]+T[r>>6&63]+T[r&63]}function le(r,s,o){for(var c,f=[],d=s;d<o;d+=3)c=(r[d]<<16&16711680)+(r[d+1]<<8&65280)+(r[d+2]&255),f.push(he(c));return f.join("")}function de(r){for(var s,o=r.length,c=o%3,f=[],d=16383,l=0,u=o-c;l<u;l+=d)f.push(le(r,l,l+d>u?u:l+d));return c===1?(s=r[o-1],f.push(T[s>>2]+T[s<<4&63]+"==")):c===2&&(s=(r[o-2]<<8)+r[o-1],f.push(T[s>>10]+T[s>>4&63]+T[s<<2&63]+"=")),f.join("")}var at={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */at.read=function(r,s,o,c,f){var d,l,u=f*8-c-1,y=(1<<u)-1,B=y>>1,g=-7,b=o?f-1:0,P=o?-1:1,D=r[s+b];for(b+=P,d=D&(1<<-g)-1,D>>=-g,g+=u;g>0;d=d*256+r[s+b],b+=P,g-=8);for(l=d&(1<<-g)-1,d>>=-g,g+=c;g>0;l=l*256+r[s+b],b+=P,g-=8);if(d===0)d=1-B;else{if(d===y)return l?NaN:(D?-1:1)*(1/0);l=l+Math.pow(2,c),d=d-B}return(D?-1:1)*l*Math.pow(2,d-c)},at.write=function(r,s,o,c,f,d){var l,u,y,B=d*8-f-1,g=(1<<B)-1,b=g>>1,P=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=c?0:d-1,tt=c?1:-1,et=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(u=isNaN(s)?1:0,l=g):(l=Math.floor(Math.log(s)/Math.LN2),s*(y=Math.pow(2,-l))<1&&(l--,y*=2),l+b>=1?s+=P/y:s+=P*Math.pow(2,1-b),s*y>=2&&(l++,y/=2),l+b>=g?(u=0,l=g):l+b>=1?(u=(s*y-1)*Math.pow(2,f),l=l+b):(u=s*Math.pow(2,b-1)*Math.pow(2,f),l=0));f>=8;r[o+D]=u&255,D+=tt,u/=256,f-=8);for(l=l<<f|u,B+=f;B>0;r[o+D]=l&255,D+=tt,l/=256,B-=8);r[o+D-tt]|=et*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const s=O,o=at,c=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=u,r.SlowBuffer=Ze,r.INSPECT_MAX_BYTES=50;const f=2147483647;r.kMaxLength=f,u.TYPED_ARRAY_SUPPORT=d(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function d(){try{const i=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(i,t),i.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(i){if(i>f)throw new RangeError('The value "'+i+'" is invalid for option "size"');const t=new Uint8Array(i);return Object.setPrototypeOf(t,u.prototype),t}function u(i,t,e){if(typeof i=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(i)}return y(i,t,e)}u.poolSize=8192;function y(i,t,e){if(typeof i=="string")return P(i,t);if(ArrayBuffer.isView(i))return tt(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(k(i,ArrayBuffer)||i&&k(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(k(i,SharedArrayBuffer)||i&&k(i.buffer,SharedArrayBuffer)))return et(i,t,e);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const n=i.valueOf&&i.valueOf();if(n!=null&&n!==i)return u.from(n,t,e);const a=Me(i);if(a)return a;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return u.from(i[Symbol.toPrimitive]("string"),t,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}u.from=function(i,t,e){return y(i,t,e)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function B(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function g(i,t,e){return B(i),i<=0?l(i):t!==void 0?typeof e=="string"?l(i).fill(t,e):l(i).fill(t):l(i)}u.alloc=function(i,t,e){return g(i,t,e)};function b(i){return B(i),l(i<0?0:xt(i)|0)}u.allocUnsafe=function(i){return b(i)},u.allocUnsafeSlow=function(i){return b(i)};function P(i,t){if((typeof t!="string"||t==="")&&(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const e=Kt(i,t)|0;let n=l(e);const a=n.write(i,t);return a!==e&&(n=n.slice(0,a)),n}function D(i){const t=i.length<0?0:xt(i.length)|0,e=l(t);for(let n=0;n<t;n+=1)e[n]=i[n]&255;return e}function tt(i){if(k(i,Uint8Array)){const t=new Uint8Array(i);return et(t.buffer,t.byteOffset,t.byteLength)}return D(i)}function et(i,t,e){if(t<0||i.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<t+(e||0))throw new RangeError('"length" is outside of buffer bounds');let n;return t===void 0&&e===void 0?n=new Uint8Array(i):e===void 0?n=new Uint8Array(i,t):n=new Uint8Array(i,t,e),Object.setPrototypeOf(n,u.prototype),n}function Me(i){if(u.isBuffer(i)){const t=xt(i.length)|0,e=l(t);return e.length===0||i.copy(e,0,0,t),e}if(i.length!==void 0)return typeof i.length!="number"||_t(i.length)?l(0):D(i);if(i.type==="Buffer"&&Array.isArray(i.data))return D(i.data)}function xt(i){if(i>=f)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f.toString(16)+" bytes");return i|0}function Ze(i){return+i!=i&&(i=0),u.alloc(+i)}u.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==u.prototype},u.compare=function(t,e){if(k(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),k(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,a=e.length;for(let h=0,p=Math.min(n,a);h<p;++h)if(t[h]!==e[h]){n=t[h],a=e[h];break}return n<a?-1:a<n?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return u.alloc(0);let n;if(e===void 0)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const a=u.allocUnsafe(e);let h=0;for(n=0;n<t.length;++n){let p=t[n];if(k(p,Uint8Array))h+p.length>a.length?(u.isBuffer(p)||(p=u.from(p)),p.copy(a,h)):Uint8Array.prototype.set.call(a,p,h);else if(u.isBuffer(p))p.copy(a,h);else throw new TypeError('"list" argument must be an Array of Buffers');h+=p.length}return a};function Kt(i,t){if(u.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||k(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);const e=i.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&e===0)return 0;let a=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return Bt(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return oe(i).length;default:if(a)return n?-1:Bt(i).length;t=(""+t).toLowerCase(),a=!0}}u.byteLength=Kt;function Qe(i,t,e){let n=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,t>>>=0,e<=t))return"";for(i||(i="utf8");;)switch(i){case"hex":return ar(this,t,e);case"utf8":case"utf-8":return Jt(this,t,e);case"ascii":return cr(this,t,e);case"latin1":case"binary":return ur(this,t,e);case"base64":return or(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fr(this,t,e);default:if(n)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),n=!0}}u.prototype._isBuffer=!0;function V(i,t,e){const n=i[t];i[t]=i[e],i[e]=n}u.prototype.swap16=function(){const t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)V(this,e,e+1);return this},u.prototype.swap32=function(){const t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)V(this,e,e+3),V(this,e+1,e+2);return this},u.prototype.swap64=function(){const t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)V(this,e,e+7),V(this,e+1,e+6),V(this,e+2,e+5),V(this,e+3,e+4);return this},u.prototype.toString=function(){const t=this.length;return t===0?"":arguments.length===0?Jt(this,0,t):Qe.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:u.compare(this,t)===0},u.prototype.inspect=function(){let t="";const e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},c&&(u.prototype[c]=u.prototype.inspect),u.prototype.compare=function(t,e,n,a,h){if(k(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(e===void 0&&(e=0),n===void 0&&(n=t?t.length:0),a===void 0&&(a=0),h===void 0&&(h=this.length),e<0||n>t.length||a<0||h>this.length)throw new RangeError("out of range index");if(a>=h&&e>=n)return 0;if(a>=h)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,a>>>=0,h>>>=0,this===t)return 0;let p=h-a,x=n-e;const L=Math.min(p,x),v=this.slice(a,h),A=t.slice(e,n);for(let I=0;I<L;++I)if(v[I]!==A[I]){p=v[I],x=A[I];break}return p<x?-1:x<p?1:0};function zt(i,t,e,n,a){if(i.length===0)return-1;if(typeof e=="string"?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,_t(e)&&(e=a?0:i.length-1),e<0&&(e=i.length+e),e>=i.length){if(a)return-1;e=i.length-1}else if(e<0)if(a)e=0;else return-1;if(typeof t=="string"&&(t=u.from(t,n)),u.isBuffer(t))return t.length===0?-1:Xt(i,t,e,n,a);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?a?Uint8Array.prototype.indexOf.call(i,t,e):Uint8Array.prototype.lastIndexOf.call(i,t,e):Xt(i,[t],e,n,a);throw new TypeError("val must be string, number or Buffer")}function Xt(i,t,e,n,a){let h=1,p=i.length,x=t.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(i.length<2||t.length<2)return-1;h=2,p/=2,x/=2,e/=2}function L(A,I){return h===1?A[I]:A.readUInt16BE(I*h)}let v;if(a){let A=-1;for(v=e;v<p;v++)if(L(i,v)===L(t,A===-1?0:v-A)){if(A===-1&&(A=v),v-A+1===x)return A*h}else A!==-1&&(v-=v-A),A=-1}else for(e+x>p&&(e=p-x),v=e;v>=0;v--){let A=!0;for(let I=0;I<x;I++)if(L(i,v+I)!==L(t,I)){A=!1;break}if(A)return v}return-1}u.prototype.includes=function(t,e,n){return this.indexOf(t,e,n)!==-1},u.prototype.indexOf=function(t,e,n){return zt(this,t,e,n,!0)},u.prototype.lastIndexOf=function(t,e,n){return zt(this,t,e,n,!1)};function tr(i,t,e,n){e=Number(e)||0;const a=i.length-e;n?(n=Number(n),n>a&&(n=a)):n=a;const h=t.length;n>h/2&&(n=h/2);let p;for(p=0;p<n;++p){const x=parseInt(t.substr(p*2,2),16);if(_t(x))return p;i[e+p]=x}return p}function er(i,t,e,n){return ct(Bt(t,i.length-e),i,e,n)}function rr(i,t,e,n){return ct(pr(t),i,e,n)}function ir(i,t,e,n){return ct(oe(t),i,e,n)}function nr(i,t,e,n){return ct(wr(t,i.length-e),i,e,n)}u.prototype.write=function(t,e,n,a){if(e===void 0)a="utf8",n=this.length,e=0;else if(n===void 0&&typeof e=="string")a=e,n=this.length,e=0;else if(isFinite(e))e=e>>>0,isFinite(n)?(n=n>>>0,a===void 0&&(a="utf8")):(a=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const h=this.length-e;if((n===void 0||n>h)&&(n=h),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");a||(a="utf8");let p=!1;for(;;)switch(a){case"hex":return tr(this,t,e,n);case"utf8":case"utf-8":return er(this,t,e,n);case"ascii":case"latin1":case"binary":return rr(this,t,e,n);case"base64":return ir(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return nr(this,t,e,n);default:if(p)throw new TypeError("Unknown encoding: "+a);a=(""+a).toLowerCase(),p=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function or(i,t,e){return t===0&&e===i.length?s.fromByteArray(i):s.fromByteArray(i.slice(t,e))}function Jt(i,t,e){e=Math.min(i.length,e);const n=[];let a=t;for(;a<e;){const h=i[a];let p=null,x=h>239?4:h>223?3:h>191?2:1;if(a+x<=e){let L,v,A,I;switch(x){case 1:h<128&&(p=h);break;case 2:L=i[a+1],(L&192)===128&&(I=(h&31)<<6|L&63,I>127&&(p=I));break;case 3:L=i[a+1],v=i[a+2],(L&192)===128&&(v&192)===128&&(I=(h&15)<<12|(L&63)<<6|v&63,I>2047&&(I<55296||I>57343)&&(p=I));break;case 4:L=i[a+1],v=i[a+2],A=i[a+3],(L&192)===128&&(v&192)===128&&(A&192)===128&&(I=(h&15)<<18|(L&63)<<12|(v&63)<<6|A&63,I>65535&&I<1114112&&(p=I))}}p===null?(p=65533,x=1):p>65535&&(p-=65536,n.push(p>>>10&1023|55296),p=56320|p&1023),n.push(p),a+=x}return sr(n)}const Mt=4096;function sr(i){const t=i.length;if(t<=Mt)return String.fromCharCode.apply(String,i);let e="",n=0;for(;n<t;)e+=String.fromCharCode.apply(String,i.slice(n,n+=Mt));return e}function cr(i,t,e){let n="";e=Math.min(i.length,e);for(let a=t;a<e;++a)n+=String.fromCharCode(i[a]&127);return n}function ur(i,t,e){let n="";e=Math.min(i.length,e);for(let a=t;a<e;++a)n+=String.fromCharCode(i[a]);return n}function ar(i,t,e){const n=i.length;(!t||t<0)&&(t=0),(!e||e<0||e>n)&&(e=n);let a="";for(let h=t;h<e;++h)a+=yr[i[h]];return a}function fr(i,t,e){const n=i.slice(t,e);let a="";for(let h=0;h<n.length-1;h+=2)a+=String.fromCharCode(n[h]+n[h+1]*256);return a}u.prototype.slice=function(t,e){const n=this.length;t=~~t,e=e===void 0?n:~~e,t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),e<t&&(e=t);const a=this.subarray(t,e);return Object.setPrototypeOf(a,u.prototype),a};function U(i,t,e){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+t>e)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(t,e,n){t=t>>>0,e=e>>>0,n||U(t,e,this.length);let a=this[t],h=1,p=0;for(;++p<e&&(h*=256);)a+=this[t+p]*h;return a},u.prototype.readUintBE=u.prototype.readUIntBE=function(t,e,n){t=t>>>0,e=e>>>0,n||U(t,e,this.length);let a=this[t+--e],h=1;for(;e>0&&(h*=256);)a+=this[t+--e]*h;return a},u.prototype.readUint8=u.prototype.readUInt8=function(t,e){return t=t>>>0,e||U(t,1,this.length),this[t]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(t,e){return t=t>>>0,e||U(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(t,e){return t=t>>>0,e||U(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(t,e){return t=t>>>0,e||U(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(t,e){return t=t>>>0,e||U(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readBigUInt64LE=W(function(t){t=t>>>0,M(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&rt(t,this.length-8);const a=e+this[++t]*2**8+this[++t]*2**16+this[++t]*2**24,h=this[++t]+this[++t]*2**8+this[++t]*2**16+n*2**24;return BigInt(a)+(BigInt(h)<<BigInt(32))}),u.prototype.readBigUInt64BE=W(function(t){t=t>>>0,M(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&rt(t,this.length-8);const a=e*2**24+this[++t]*2**16+this[++t]*2**8+this[++t],h=this[++t]*2**24+this[++t]*2**16+this[++t]*2**8+n;return(BigInt(a)<<BigInt(32))+BigInt(h)}),u.prototype.readIntLE=function(t,e,n){t=t>>>0,e=e>>>0,n||U(t,e,this.length);let a=this[t],h=1,p=0;for(;++p<e&&(h*=256);)a+=this[t+p]*h;return h*=128,a>=h&&(a-=Math.pow(2,8*e)),a},u.prototype.readIntBE=function(t,e,n){t=t>>>0,e=e>>>0,n||U(t,e,this.length);let a=e,h=1,p=this[t+--a];for(;a>0&&(h*=256);)p+=this[t+--a]*h;return h*=128,p>=h&&(p-=Math.pow(2,8*e)),p},u.prototype.readInt8=function(t,e){return t=t>>>0,e||U(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},u.prototype.readInt16LE=function(t,e){t=t>>>0,e||U(t,2,this.length);const n=this[t]|this[t+1]<<8;return n&32768?n|4294901760:n},u.prototype.readInt16BE=function(t,e){t=t>>>0,e||U(t,2,this.length);const n=this[t+1]|this[t]<<8;return n&32768?n|4294901760:n},u.prototype.readInt32LE=function(t,e){return t=t>>>0,e||U(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return t=t>>>0,e||U(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readBigInt64LE=W(function(t){t=t>>>0,M(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&rt(t,this.length-8);const a=this[t+4]+this[t+5]*2**8+this[t+6]*2**16+(n<<24);return(BigInt(a)<<BigInt(32))+BigInt(e+this[++t]*2**8+this[++t]*2**16+this[++t]*2**24)}),u.prototype.readBigInt64BE=W(function(t){t=t>>>0,M(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&rt(t,this.length-8);const a=(e<<24)+this[++t]*2**16+this[++t]*2**8+this[++t];return(BigInt(a)<<BigInt(32))+BigInt(this[++t]*2**24+this[++t]*2**16+this[++t]*2**8+n)}),u.prototype.readFloatLE=function(t,e){return t=t>>>0,e||U(t,4,this.length),o.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return t=t>>>0,e||U(t,4,this.length),o.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return t=t>>>0,e||U(t,8,this.length),o.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return t=t>>>0,e||U(t,8,this.length),o.read(this,t,!1,52,8)};function N(i,t,e,n,a,h){if(!u.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<h)throw new RangeError('"value" argument is out of bounds');if(e+n>i.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(t,e,n,a){if(t=+t,e=e>>>0,n=n>>>0,!a){const x=Math.pow(2,8*n)-1;N(this,t,e,n,x,0)}let h=1,p=0;for(this[e]=t&255;++p<n&&(h*=256);)this[e+p]=t/h&255;return e+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(t,e,n,a){if(t=+t,e=e>>>0,n=n>>>0,!a){const x=Math.pow(2,8*n)-1;N(this,t,e,n,x,0)}let h=n-1,p=1;for(this[e+h]=t&255;--h>=0&&(p*=256);)this[e+h]=t/p&255;return e+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,1,255,0),this[e]=t&255,e+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,2,65535,0),this[e]=t&255,this[e+1]=t>>>8,e+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=t&255,e+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t&255,e+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};function Zt(i,t,e,n,a){ne(t,n,a,i,e,7);let h=Number(t&BigInt(4294967295));i[e++]=h,h=h>>8,i[e++]=h,h=h>>8,i[e++]=h,h=h>>8,i[e++]=h;let p=Number(t>>BigInt(32)&BigInt(4294967295));return i[e++]=p,p=p>>8,i[e++]=p,p=p>>8,i[e++]=p,p=p>>8,i[e++]=p,e}function Qt(i,t,e,n,a){ne(t,n,a,i,e,7);let h=Number(t&BigInt(4294967295));i[e+7]=h,h=h>>8,i[e+6]=h,h=h>>8,i[e+5]=h,h=h>>8,i[e+4]=h;let p=Number(t>>BigInt(32)&BigInt(4294967295));return i[e+3]=p,p=p>>8,i[e+2]=p,p=p>>8,i[e+1]=p,p=p>>8,i[e]=p,e+8}u.prototype.writeBigUInt64LE=W(function(t,e=0){return Zt(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=W(function(t,e=0){return Qt(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(t,e,n,a){if(t=+t,e=e>>>0,!a){const L=Math.pow(2,8*n-1);N(this,t,e,n,L-1,-L)}let h=0,p=1,x=0;for(this[e]=t&255;++h<n&&(p*=256);)t<0&&x===0&&this[e+h-1]!==0&&(x=1),this[e+h]=(t/p>>0)-x&255;return e+n},u.prototype.writeIntBE=function(t,e,n,a){if(t=+t,e=e>>>0,!a){const L=Math.pow(2,8*n-1);N(this,t,e,n,L-1,-L)}let h=n-1,p=1,x=0;for(this[e+h]=t&255;--h>=0&&(p*=256);)t<0&&x===0&&this[e+h+1]!==0&&(x=1),this[e+h]=(t/p>>0)-x&255;return e+n},u.prototype.writeInt8=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=t&255,e+1},u.prototype.writeInt16LE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,2,32767,-32768),this[e]=t&255,this[e+1]=t>>>8,e+2},u.prototype.writeInt16BE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=t&255,e+2},u.prototype.writeInt32LE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,4,2147483647,-2147483648),this[e]=t&255,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},u.prototype.writeInt32BE=function(t,e,n){return t=+t,e=e>>>0,n||N(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4},u.prototype.writeBigInt64LE=W(function(t,e=0){return Zt(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=W(function(t,e=0){return Qt(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function te(i,t,e,n,a,h){if(e+n>i.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function ee(i,t,e,n,a){return t=+t,e=e>>>0,a||te(i,t,e,4),o.write(i,t,e,n,23,4),e+4}u.prototype.writeFloatLE=function(t,e,n){return ee(this,t,e,!0,n)},u.prototype.writeFloatBE=function(t,e,n){return ee(this,t,e,!1,n)};function re(i,t,e,n,a){return t=+t,e=e>>>0,a||te(i,t,e,8),o.write(i,t,e,n,52,8),e+8}u.prototype.writeDoubleLE=function(t,e,n){return re(this,t,e,!0,n)},u.prototype.writeDoubleBE=function(t,e,n){return re(this,t,e,!1,n)},u.prototype.copy=function(t,e,n,a){if(!u.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),!a&&a!==0&&(a=this.length),e>=t.length&&(e=t.length),e||(e=0),a>0&&a<n&&(a=n),a===n||t.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("sourceEnd out of bounds");a>this.length&&(a=this.length),t.length-e<a-n&&(a=t.length-e+n);const h=a-n;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(e,n,a):Uint8Array.prototype.set.call(t,this.subarray(n,a),e),h},u.prototype.fill=function(t,e,n,a){if(typeof t=="string"){if(typeof e=="string"?(a=e,e=0,n=this.length):typeof n=="string"&&(a=n,n=this.length),a!==void 0&&typeof a!="string")throw new TypeError("encoding must be a string");if(typeof a=="string"&&!u.isEncoding(a))throw new TypeError("Unknown encoding: "+a);if(t.length===1){const p=t.charCodeAt(0);(a==="utf8"&&p<128||a==="latin1")&&(t=p)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;e=e>>>0,n=n===void 0?this.length:n>>>0,t||(t=0);let h;if(typeof t=="number")for(h=e;h<n;++h)this[h]=t;else{const p=u.isBuffer(t)?t:u.from(t,a),x=p.length;if(x===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(h=0;h<n-e;++h)this[h+e]=p[h%x]}return this};const J={};function gt(i,t,e){J[i]=class extends e{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(a){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:a,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}gt("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),gt("ERR_INVALID_ARG_TYPE",function(i,t){return`The "${i}" argument must be of type number. Received type ${typeof t}`},TypeError),gt("ERR_OUT_OF_RANGE",function(i,t,e){let n=`The value of "${i}" is out of range.`,a=e;return Number.isInteger(e)&&Math.abs(e)>2**32?a=ie(String(e)):typeof e=="bigint"&&(a=String(e),(e>BigInt(2)**BigInt(32)||e<-(BigInt(2)**BigInt(32)))&&(a=ie(a)),a+="n"),n+=` It must be ${t}. Received ${a}`,n},RangeError);function ie(i){let t="",e=i.length;const n=i[0]==="-"?1:0;for(;e>=n+4;e-=3)t=`_${i.slice(e-3,e)}${t}`;return`${i.slice(0,e)}${t}`}function hr(i,t,e){M(t,"offset"),(i[t]===void 0||i[t+e]===void 0)&&rt(t,i.length-(e+1))}function ne(i,t,e,n,a,h){if(i>e||i<t){const p=typeof t=="bigint"?"n":"";let x;throw h>3?t===0||t===BigInt(0)?x=`>= 0${p} and < 2${p} ** ${(h+1)*8}${p}`:x=`>= -(2${p} ** ${(h+1)*8-1}${p}) and < 2 ** ${(h+1)*8-1}${p}`:x=`>= ${t}${p} and <= ${e}${p}`,new J.ERR_OUT_OF_RANGE("value",x,i)}hr(n,a,h)}function M(i,t){if(typeof i!="number")throw new J.ERR_INVALID_ARG_TYPE(t,"number",i)}function rt(i,t,e){throw Math.floor(i)!==i?(M(i,e),new J.ERR_OUT_OF_RANGE(e||"offset","an integer",i)):t<0?new J.ERR_BUFFER_OUT_OF_BOUNDS:new J.ERR_OUT_OF_RANGE(e||"offset",`>= ${e?1:0} and <= ${t}`,i)}const lr=/[^+/0-9A-Za-z-_]/g;function dr(i){if(i=i.split("=")[0],i=i.trim().replace(lr,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function Bt(i,t){t=t||1/0;let e;const n=i.length;let a=null;const h=[];for(let p=0;p<n;++p){if(e=i.charCodeAt(p),e>55295&&e<57344){if(!a){if(e>56319){(t-=3)>-1&&h.push(239,191,189);continue}else if(p+1===n){(t-=3)>-1&&h.push(239,191,189);continue}a=e;continue}if(e<56320){(t-=3)>-1&&h.push(239,191,189),a=e;continue}e=(a-55296<<10|e-56320)+65536}else a&&(t-=3)>-1&&h.push(239,191,189);if(a=null,e<128){if((t-=1)<0)break;h.push(e)}else if(e<2048){if((t-=2)<0)break;h.push(e>>6|192,e&63|128)}else if(e<65536){if((t-=3)<0)break;h.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((t-=4)<0)break;h.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return h}function pr(i){const t=[];for(let e=0;e<i.length;++e)t.push(i.charCodeAt(e)&255);return t}function wr(i,t){let e,n,a;const h=[];for(let p=0;p<i.length&&!((t-=2)<0);++p)e=i.charCodeAt(p),n=e>>8,a=e%256,h.push(a),h.push(n);return h}function oe(i){return s.toByteArray(dr(i))}function ct(i,t,e,n){let a;for(a=0;a<n&&!(a+e>=t.length||a>=i.length);++a)t[a+e]=i[a];return a}function k(i,t){return i instanceof t||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===t.name}function _t(i){return i!==i}const yr=function(){const i="0123456789abcdef",t=new Array(256);for(let e=0;e<16;++e){const n=e*16;for(let a=0;a<16;++a)t[n+a]=i[e]+i[a]}return t}();function W(i){return typeof BigInt>"u"?Er:i}function Er(){throw new Error("BigInt not supported")}})(E);var mt;(function(r){r[r.AudioOutputStart=1]="AudioOutputStart",r[r.AudioOutputStop=2]="AudioOutputStop",r[r.AudioInputConfig=3]="AudioInputConfig",r[r.AudioPhonecallStart=4]="AudioPhonecallStart",r[r.AudioPhonecallStop=5]="AudioPhonecallStop",r[r.AudioNaviStart=6]="AudioNaviStart",r[r.AudioNaviStop=7]="AudioNaviStop",r[r.AudioSiriStart=8]="AudioSiriStart",r[r.AudioSiriStop=9]="AudioSiriStop",r[r.AudioMediaStart=10]="AudioMediaStart",r[r.AudioMediaStop=11]="AudioMediaStop",r[r.AudioAlertStart=12]="AudioAlertStart",r[r.AudioAlertStop=13]="AudioAlertStop"})(mt||(mt={}));class F{constructor(s){w(this,"header");this.header=s}}class vt extends F{constructor(o,c){super(o);w(this,"value");this.value=c.readUInt32LE(0)}}class pe extends F{constructor(o,c){super(o);w(this,"a");w(this,"b");this.a=c.readUInt32LE(0),this.b=c.readUInt32LE(4)}}class we extends F{constructor(o,c){super(o);w(this,"version");this.version=c.toString("ascii")}}class ye extends F{constructor(o,c){super(o);w(this,"address");this.address=c.toString("ascii")}}class Ee extends F{constructor(o,c){super(o);w(this,"pin");this.pin=c.toString("ascii")}}class xe extends F{constructor(o,c){super(o);w(this,"name");this.name=c.toString("ascii")}}class ge extends F{constructor(o,c){super(o);w(this,"name");this.name=c.toString("ascii")}}class Be extends F{constructor(o,c){super(o);w(this,"link");this.link=c.toString("ascii")}}class _e extends F{constructor(o,c){super(o);w(this,"data");this.data=c.toString("ascii")}}var G;(function(r){r[r.AndroidMirror=1]="AndroidMirror",r[r.CarPlay=3]="CarPlay",r[r.iPhoneMirror=4]="iPhoneMirror",r[r.AndroidAuto=5]="AndroidAuto",r[r.HiCar=6]="HiCar"})(G||(G={}));class Lt extends F{constructor(o,c){super(o);w(this,"phoneType");w(this,"wifi");E.Buffer.byteLength(c)===8?(this.phoneType=c.readUInt32LE(0),this.wifi=c.readUInt32LE(4),console.debug("wifi avail, phone type: ",G[this.phoneType]," wifi: ",this.wifi)):(this.phoneType=c.readUInt32LE(0),console.debug("no wifi avail, phone type: ",G[this.phoneType]))}}class At extends F{constructor(s){super(s)}}const Ie={1:{frequency:44100,channel:2,bitrate:16},2:{frequency:44100,channel:2,bitrate:16},3:{frequency:8e3,channel:1,bitrate:16},4:{frequency:48e3,channel:2,bitrate:16},5:{frequency:16e3,channel:1,bitrate:16},6:{frequency:24e3,channel:1,bitrate:16},7:{frequency:16e3,channel:2,bitrate:16}};class bt extends F{constructor(o,c){super(o);w(this,"command");w(this,"decodeType");w(this,"volume");w(this,"volumeDuration");w(this,"audioType");w(this,"data");this.decodeType=c.readUInt32LE(0),this.volume=c.readFloatLE(4),this.audioType=c.readUInt32LE(8);const f=c.length-12;f===1?this.command=c.readInt8(12):f===4?this.volumeDuration=c.readFloatLE(12):this.data=new Int16Array(c.buffer,12)}}class Ut extends F{constructor(o,c){super(o);w(this,"width");w(this,"height");w(this,"flags");w(this,"length");w(this,"unknown");w(this,"data");this.width=c.readUInt32LE(0),this.height=c.readUInt32LE(4),this.flags=c.readUInt32LE(8),this.length=c.readUInt32LE(12),this.unknown=c.readUInt32LE(16),this.data=c.subarray(20)}}var it;(function(r){r[r.Data=1]="Data",r[r.AlbumCover=3]="AlbumCover"})(it||(it={}));class Ft extends F{constructor(o,c){super(o);w(this,"payload");const f=c.readUInt32LE(0);if(f===it.AlbumCover){const d=c.subarray(4);this.payload={type:f,base64Image:d.toString("base64")}}else if(f===it.Data){const d=c.subarray(4,c.length-1);this.payload={type:f,media:JSON.parse(d.toString("utf8"))}}else console.info(`Unexpected media type: ${f}`)}}class me extends F{constructor(o,c){super(o);w(this,"width");w(this,"height");w(this,"fps");w(this,"format");w(this,"packetMax");w(this,"iBox");w(this,"phoneMode");this.width=c.readUInt32LE(0),this.height=c.readUInt32LE(4),this.fps=c.readUInt32LE(8),this.format=c.readUInt32LE(12),this.packetMax=c.readUInt32LE(16),this.iBox=c.readUInt32LE(20),this.phoneMode=c.readUInt32LE(24)}}class ve extends F{constructor(o,c){super(o);w(this,"settings");this.settings=JSON.parse(c.toString())}}class Le extends F{constructor(o,c){super(o);w(this,"phase");this.phase=c.readUInt32LE(0)}}var ft;(function(r){r[r.invalid=0]="invalid",r[r.startRecordAudio=1]="startRecordAudio",r[r.stopRecordAudio=2]="stopRecordAudio",r[r.requestHostUI=3]="requestHostUI",r[r.siri=5]="siri",r[r.mic=7]="mic",r[r.boxMic=15]="boxMic",r[r.enableNightMode=16]="enableNightMode",r[r.disableNightMode=17]="disableNightMode",r[r.wifi24g=24]="wifi24g",r[r.wifi5g=25]="wifi5g",r[r.left=100]="left",r[r.right=101]="right",r[r.frame=12]="frame",r[r.audioTransferOn=22]="audioTransferOn",r[r.audioTransferOff=23]="audioTransferOff",r[r.selectDown=104]="selectDown",r[r.selectUp=105]="selectUp",r[r.back=106]="back",r[r.down=114]="down",r[r.home=200]="home",r[r.play=201]="play",r[r.pause=202]="pause",r[r.next=204]="next",r[r.prev=205]="prev",r[r.requestVideoFocus=500]="requestVideoFocus",r[r.releaseVideoFocus=501]="releaseVideoFocus",r[r.wifiEnable=1e3]="wifiEnable",r[r.autoConnetEnable=1001]="autoConnetEnable",r[r.wifiConnect=1002]="wifiConnect",r[r.scanningDevice=1003]="scanningDevice",r[r.deviceFound=1004]="deviceFound",r[r.deviceNotFound=1005]="deviceNotFound",r[r.connectDeviceFailed=1006]="connectDeviceFailed",r[r.btConnected=1007]="btConnected",r[r.btDisconnected=1008]="btDisconnected",r[r.wifiConnected=1009]="wifiConnected",r[r.wifiDisconnected=1010]="wifiDisconnected",r[r.btPairStart=1011]="btPairStart",r[r.wifiPair=1012]="wifiPair"})(ft||(ft={}));var m;(function(r){r[r.Open=1]="Open",r[r.Plugged=2]="Plugged",r[r.Phase=3]="Phase",r[r.Unplugged=4]="Unplugged",r[r.Touch=5]="Touch",r[r.VideoData=6]="VideoData",r[r.AudioData=7]="AudioData",r[r.Command=8]="Command",r[r.LogoType=9]="LogoType",r[r.DisconnectPhone=15]="DisconnectPhone",r[r.CloseDongle=21]="CloseDongle",r[r.BluetoothAddress=10]="BluetoothAddress",r[r.BluetoothPIN=12]="BluetoothPIN",r[r.BluetoothDeviceName=13]="BluetoothDeviceName",r[r.WifiDeviceName=14]="WifiDeviceName",r[r.BluetoothPairedList=18]="BluetoothPairedList",r[r.ManufacturerInfo=20]="ManufacturerInfo",r[r.HiCarLink=24]="HiCarLink",r[r.BoxSettings=25]="BoxSettings",r[r.MediaData=42]="MediaData",r[r.SendFile=153]="SendFile",r[r.HeartBeat=170]="HeartBeat",r[r.SoftwareVersion=204]="SoftwareVersion"})(m||(m={}));class Z extends Error{}const j=class j{constructor(s,o){w(this,"length");w(this,"type");this.length=s,this.type=o}static fromBuffer(s){if(s.length!==16)throw new Z(`Invalid buffer size - Expecting 16, got ${s.length}`);const o=s.readUInt32LE(0);if(o!==j.magic)throw new Z(`Invalid magic number, received ${o}`);const c=s.readUInt32LE(4),f=s.readUInt32LE(8),d=s.readUInt32LE(12);if(d!=((f^-1)&4294967295)>>>0)throw new Z(`Invalid type check, received ${d}`);return new j(c,f)}static asBuffer(s,o){const c=E.Buffer.alloc(4);c.writeUInt32LE(o);const f=E.Buffer.alloc(4);f.writeUInt32LE(s);const d=E.Buffer.alloc(4);d.writeUInt32LE(((s^-1)&4294967295)>>>0);const l=E.Buffer.alloc(4);return l.writeUInt32LE(j.magic),E.Buffer.concat([l,c,f,d])}toMessage(s){const{type:o}=this;if(s)switch(o){case m.AudioData:return new bt(this,s);case m.VideoData:return new Ut(this,s);case m.MediaData:return new Ft(this,s);case m.BluetoothAddress:return new ye(this,s);case m.BluetoothDeviceName:return new xe(this,s);case m.BluetoothPIN:return new Ee(this,s);case m.ManufacturerInfo:return new pe(this,s);case m.SoftwareVersion:return new we(this,s);case m.Command:return new vt(this,s);case m.Plugged:return new Lt(this,s);case m.WifiDeviceName:return new ge(this,s);case m.HiCarLink:return new Be(this,s);case m.BluetoothPairedList:return new _e(this,s);case m.Open:return new me(this,s);case m.BoxSettings:return new ve(this,s);case m.Phase:return new Le(this,s);default:return console.debug(`Unknown message type: ${o}, data: ${s.toString()}`),null}else switch(o){case m.Unplugged:return new At(this);default:return console.debug(`Unknown message type without data: ${o}`),null}}};w(j,"dataLength",16),w(j,"magic",1437226410);let Y=j;const St=(r,s,o)=>Math.max(s,Math.min(r,o));function Ae(){return Math.round(Date.now()/1e3)}class Dt{serialise(){return Y.asBuffer(this.type,0)}}class K extends Dt{serialise(){const s=this.getPayload(),o=E.Buffer.byteLength(s),c=Y.asBuffer(this.type,o);return E.Buffer.concat([c,s])}}class $ extends K{constructor(o){super();w(this,"type",m.Command);w(this,"value");this.value=ft[o]}getPayload(){const o=E.Buffer.alloc(4);return o.writeUInt32LE(this.value),o}}var Nt;(function(r){r[r.Down=14]="Down",r[r.Move=15]="Move",r[r.Up=16]="Up"})(Nt||(Nt={}));class be extends K{constructor(o,c,f){super();w(this,"type",m.Touch);w(this,"x");w(this,"y");w(this,"action");this.x=o,this.y=c,this.action=f}getPayload(){const o=E.Buffer.alloc(4),c=E.Buffer.alloc(4),f=E.Buffer.alloc(4),d=E.Buffer.alloc(4);o.writeUInt32LE(this.action);const l=St(1e4*this.x,0,1e4),u=St(1e4*this.y,0,1e4);return c.writeUInt32LE(l),f.writeUInt32LE(u),E.Buffer.concat([o,c,f,d])}}class Ue extends K{constructor(o){super();w(this,"type",m.AudioData);w(this,"data");this.data=o}getPayload(){const o=E.Buffer.alloc(12);return o.writeUInt32LE(5,0),o.writeFloatLE(0,4),o.writeUInt32LE(3,8),E.Buffer.concat([o,E.Buffer.from(this.data.buffer)])}}class Rt extends K{constructor(o,c){super();w(this,"type",m.SendFile);w(this,"content");w(this,"fileName");w(this,"getFileName",o=>E.Buffer.from(o+"\0","ascii"));w(this,"getLength",o=>{const c=E.Buffer.alloc(4);return c.writeUInt32LE(E.Buffer.byteLength(o)),c});this.content=o,this.fileName=c}getPayload(){const o=this.getFileName(this.fileName),c=this.getLength(o),f=this.getLength(this.content),d=[c,o,f,this.content];return E.Buffer.concat(d)}}var H;(function(r){r.DPI="/tmp/screen_dpi",r.NIGHT_MODE="/tmp/night_mode",r.HAND_DRIVE_MODE="/tmp/hand_drive_mode",r.CHARGE_MODE="/tmp/charge_mode",r.BOX_NAME="/etc/box_name",r.OEM_ICON="/etc/oem_icon.png",r.AIRPLAY_CONFIG="/etc/airplay.conf",r.ICON_120="/etc/icon_120x120.png",r.ICON_180="/etc/icon_180x180.png",r.ICON_250="/etc/icon_256x256.png",r.ANDROID_WORK_MODE="/etc/android_work_mode"})(H||(H={}));class ht extends Rt{constructor(s,o){const c=E.Buffer.alloc(4);c.writeUInt32LE(s),super(c,o)}}class lt extends ht{constructor(s,o){super(Number(s),o)}}class Fe extends Rt{constructor(s,o){s.length>16&&console.error("string too long");const c=E.Buffer.from(s,"ascii");super(c,o)}}class Se extends Dt{constructor(){super(...arguments);w(this,"type",m.HeartBeat)}}class De extends K{constructor(o){super();w(this,"type",m.Open);w(this,"config");this.config=o}getPayload(){const{config:o}=this,c=E.Buffer.alloc(4);c.writeUInt32LE(o.width);const f=E.Buffer.alloc(4);f.writeUInt32LE(o.height);const d=E.Buffer.alloc(4);d.writeUInt32LE(o.fps);const l=E.Buffer.alloc(4);l.writeUInt32LE(o.format);const u=E.Buffer.alloc(4);u.writeUInt32LE(o.packetMax);const y=E.Buffer.alloc(4);y.writeUInt32LE(o.iBoxVersion);const B=E.Buffer.alloc(4);return B.writeUInt32LE(o.phoneWorkMode),E.Buffer.concat([c,f,d,l,u,y,B])}}class Ne extends K{constructor(o,c=null){super();w(this,"type",m.BoxSettings);w(this,"syncTime");w(this,"config");this.config=o,this.syncTime=c}getPayload(){return E.Buffer.from(JSON.stringify({mediaDelay:this.config.mediaDelay,syncTime:this.syncTime??Ae(),androidAutoSizeW:this.config.width,androidAutoSizeH:this.config.height}),"ascii")}}var Pt;(function(r){r[r.HomeButton=1]="HomeButton",r[r.Siri=2]="Siri"})(Pt||(Pt={}));var dt={exports:{}},z=typeof Reflect=="object"?Reflect:null,Ot=z&&typeof z.apply=="function"?z.apply:function(s,o,c){return Function.prototype.apply.call(s,o,c)},nt;z&&typeof z.ownKeys=="function"?nt=z.ownKeys:Object.getOwnPropertySymbols?nt=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:nt=function(s){return Object.getOwnPropertyNames(s)};function Re(r){console&&console.warn&&console.warn(r)}var Tt=Number.isNaN||function(s){return s!==s};function _(){_.init.call(this)}dt.exports=_,dt.exports.once=ke,_.EventEmitter=_,_.prototype._events=void 0,_.prototype._eventsCount=0,_.prototype._maxListeners=void 0;var kt=10;function ot(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return kt},set:function(r){if(typeof r!="number"||r<0||Tt(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");kt=r}}),_.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},_.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||Tt(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function $t(r){return r._maxListeners===void 0?_.defaultMaxListeners:r._maxListeners}_.prototype.getMaxListeners=function(){return $t(this)},_.prototype.emit=function(s){for(var o=[],c=1;c<arguments.length;c++)o.push(arguments[c]);var f=s==="error",d=this._events;if(d!==void 0)f=f&&d.error===void 0;else if(!f)return!1;if(f){var l;if(o.length>0&&(l=o[0]),l instanceof Error)throw l;var u=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw u.context=l,u}var y=d[s];if(y===void 0)return!1;if(typeof y=="function")Ot(y,this,o);else for(var B=y.length,g=Vt(y,B),c=0;c<B;++c)Ot(g[c],this,o);return!0};function Ht(r,s,o,c){var f,d,l;if(ot(o),d=r._events,d===void 0?(d=r._events=Object.create(null),r._eventsCount=0):(d.newListener!==void 0&&(r.emit("newListener",s,o.listener?o.listener:o),d=r._events),l=d[s]),l===void 0)l=d[s]=o,++r._eventsCount;else if(typeof l=="function"?l=d[s]=c?[o,l]:[l,o]:c?l.unshift(o):l.push(o),f=$t(r),f>0&&l.length>f&&!l.warned){l.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=r,u.type=s,u.count=l.length,Re(u)}return r}_.prototype.addListener=function(s,o){return Ht(this,s,o,!1)},_.prototype.on=_.prototype.addListener,_.prototype.prependListener=function(s,o){return Ht(this,s,o,!0)};function Pe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Wt(r,s,o){var c={fired:!1,wrapFn:void 0,target:r,type:s,listener:o},f=Pe.bind(c);return f.listener=o,c.wrapFn=f,f}_.prototype.once=function(s,o){return ot(o),this.on(s,Wt(this,s,o)),this},_.prototype.prependOnceListener=function(s,o){return ot(o),this.prependListener(s,Wt(this,s,o)),this},_.prototype.removeListener=function(s,o){var c,f,d,l,u;if(ot(o),f=this._events,f===void 0)return this;if(c=f[s],c===void 0)return this;if(c===o||c.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete f[s],f.removeListener&&this.emit("removeListener",s,c.listener||o));else if(typeof c!="function"){for(d=-1,l=c.length-1;l>=0;l--)if(c[l]===o||c[l].listener===o){u=c[l].listener,d=l;break}if(d<0)return this;d===0?c.shift():Oe(c,d),c.length===1&&(f[s]=c[0]),f.removeListener!==void 0&&this.emit("removeListener",s,u||o)}return this},_.prototype.off=_.prototype.removeListener,_.prototype.removeAllListeners=function(s){var o,c,f;if(c=this._events,c===void 0)return this;if(c.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):c[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete c[s]),this;if(arguments.length===0){var d=Object.keys(c),l;for(f=0;f<d.length;++f)l=d[f],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=c[s],typeof o=="function")this.removeListener(s,o);else if(o!==void 0)for(f=o.length-1;f>=0;f--)this.removeListener(s,o[f]);return this};function Ct(r,s,o){var c=r._events;if(c===void 0)return[];var f=c[s];return f===void 0?[]:typeof f=="function"?o?[f.listener||f]:[f]:o?Te(f):Vt(f,f.length)}_.prototype.listeners=function(s){return Ct(this,s,!0)},_.prototype.rawListeners=function(s){return Ct(this,s,!1)},_.listenerCount=function(r,s){return typeof r.listenerCount=="function"?r.listenerCount(s):jt.call(r,s)},_.prototype.listenerCount=jt;function jt(r){var s=this._events;if(s!==void 0){var o=s[r];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}_.prototype.eventNames=function(){return this._eventsCount>0?nt(this._events):[]};function Vt(r,s){for(var o=new Array(s),c=0;c<s;++c)o[c]=r[c];return o}function Oe(r,s){for(;s+1<r.length;s++)r[s]=r[s+1];r.pop()}function Te(r){for(var s=new Array(r.length),o=0;o<s.length;++o)s[o]=r[o].listener||r[o];return s}function ke(r,s){return new Promise(function(o,c){function f(l){r.removeListener(s,d),c(l)}function d(){typeof r.removeListener=="function"&&r.removeListener("error",f),o([].slice.call(arguments))}qt(r,s,d,{once:!0}),s!=="error"&&$e(r,f,{once:!0})})}function $e(r,s,o){typeof r.on=="function"&&qt(r,"error",s,o)}function qt(r,s,o,c){if(typeof r.on=="function")c.once?r.once(s,o):r.on(s,o);else if(typeof r.addEventListener=="function")r.addEventListener(s,function f(d){c.once&&r.removeEventListener(s,f),o(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var He=dt.exports,We=C(He);const Ce=1,je=5;var pt;(function(r){r[r.LHD=0]="LHD",r[r.RHD=1]="RHD"})(pt||(pt={}));const Ve={width:800,height:640,fps:20,dpi:160,format:5,iBoxVersion:2,phoneWorkMode:2,packetMax:49152,boxName:"nodePlay",nightMode:!1,hand:pt.LHD,mediaDelay:300,audioTransferMode:!1,wifiType:"5ghz",micType:"os",phoneConfig:{[G.CarPlay]:{frameInterval:5e3},[G.AndroidAuto]:{frameInterval:null}}};class Q extends Error{}class wt extends We{constructor(){super(...arguments);w(this,"_heartbeatInterval",null);w(this,"_device",null);w(this,"_inEP",null);w(this,"_outEP",null);w(this,"errorCount",0);w(this,"initialise",async o=>{if(!this._device)try{if(this._device=o,console.debug("initializing"),!o.opened)throw new Q("Illegal state - device not opened");if(await this._device.selectConfiguration(Ce),!this._device.configuration)throw new Q("Illegal state - device has no configuration");console.debug("getting interface");const{interfaceNumber:c,alternate:{endpoints:f}}=this._device.configuration.interfaces[0],d=f.find(u=>u.direction==="in"),l=f.find(u=>u.direction==="out");if(!d)throw new Q("Illegal state - no IN endpoint found");if(!l)throw new Q("Illegal state - no OUT endpoint found");this._inEP=d,this._outEP=l,console.debug("claiming"),await this._device.claimInterface(c),console.debug(this._device)}catch(c){throw this.close(),c}});w(this,"send",async o=>{var c,f;if(!((c=this._device)!=null&&c.opened))return null;try{const d=o.serialise(),l=await((f=this._device)==null?void 0:f.transferOut(this._outEP.endpointNumber,d));return l.status!=="ok"?(console.error(l),!1):!0}catch(d){return console.error("Failure sending message to dongle",d),!1}});w(this,"readLoop",async()=>{var o,c,f,d,l,u;for(;(o=this._device)!=null&&o.opened;){if(this.errorCount>=je){this.close(),this.emit("failure");return}try{const y=await((c=this._device)==null?void 0:c.transferIn(this._inEP.endpointNumber,Y.dataLength)),B=(f=y==null?void 0:y.data)==null?void 0:f.buffer;if(!B)throw new Z("Failed to read header data");const g=Y.fromBuffer(E.Buffer.from(B));let b;if(g.length){const D=(u=(l=await((d=this._device)==null?void 0:d.transferIn(this._inEP.endpointNumber,g.length)))==null?void 0:l.data)==null?void 0:u.buffer;if(!D){console.error("Failed to read extra data");return}b=E.Buffer.from(D)}const P=g.toMessage(b);P&&this.emit("message",P)}catch(y){y instanceof Z?console.error("Error parsing header for data",y):console.error("Unexpected Error parsing header for data",y),this.errorCount++}}});w(this,"start",async o=>{var g;if(!this._device)throw new Q("No device set - call initialise first");if(!((g=this._device)!=null&&g.opened))return;this.errorCount=0;const{dpi:c,nightMode:f,boxName:d,audioTransferMode:l,wifiType:u,micType:y}=o,B=[new ht(c,H.DPI),new De(o),new lt(f,H.NIGHT_MODE),new ht(o.hand,H.HAND_DRIVE_MODE),new lt(!0,H.CHARGE_MODE),new Fe(d,H.BOX_NAME),new Ne(o),new $("wifiEnable"),new $(u==="5ghz"?"wifi5g":"wifi24g"),new $(y==="box"?"boxMic":"mic"),new $(l?"audioTransferOn":"audioTransferOff")];o.androidWorkMode&&B.push(new lt(o.androidWorkMode,H.ANDROID_WORK_MODE)),await Promise.all(B.map(this.send)),setTimeout(()=>{this.send(new $("wifiConnect"))},1e3),this.readLoop(),this._heartbeatInterval=setInterval(()=>{this.send(new Se)},2e3)});w(this,"close",async()=>{this._device&&(this._heartbeatInterval&&(clearInterval(this._heartbeatInterval),this._heartbeatInterval=null),await this._device.close(),this._device=null,this._inEP=null,this._outEP=null)})}}w(wt,"knownDevices",[{vendorId:4884,productId:5408},{vendorId:4884,productId:5409}]);const{knownDevices:qe}=wt,Ge=r=>qe.some(o=>o.productId===r.productId&&o.vendorId===r.vendorId),Ye=async()=>{try{return(await navigator.usb.getDevices()).find(s=>Ge(s)?s:void 0)||null}catch{return null}};class Ke{constructor(s){w(this,"_started",!1);w(this,"_pairTimeout",null);w(this,"_frameInterval",null);w(this,"_config");w(this,"dongleDriver");w(this,"onmessage",null);w(this,"start",async s=>{if(this._started)return;const{initialise:o,start:c,send:f}=this.dongleDriver;console.debug("opening device"),await s.open(),await s.reset(),await o(s),await c(this._config),this._pairTimeout=setTimeout(()=>{console.debug("no device, sending pair"),f(new $("wifiPair"))},15e3),this._started=!0});w(this,"stop",async()=>{try{this.clearFrameInterval(),this.clearPairTimeout(),await this.dongleDriver.close()}catch(s){console.error(s)}finally{this._started=!1}});this._config=Object.assign({},Ve,s);const o=new wt;o.on("message",c=>{var f,d,l,u,y,B;if(c instanceof Lt){this.clearPairTimeout(),this.clearFrameInterval();const g=this._config.phoneConfig[c.phoneType];g!=null&&g.frameInterval&&(this._frameInterval=setInterval(()=>{this.dongleDriver.send(new $("frame"))},g==null?void 0:g.frameInterval)),(f=this.onmessage)==null||f.call(this,{type:"plugged"})}else c instanceof At?(d=this.onmessage)==null||d.call(this,{type:"unplugged"}):c instanceof Ut?(this.clearPairTimeout(),(l=this.onmessage)==null||l.call(this,{type:"video",message:c})):c instanceof bt?(this.clearPairTimeout(),(u=this.onmessage)==null||u.call(this,{type:"audio",message:c})):c instanceof Ft?(this.clearPairTimeout(),(y=this.onmessage)==null||y.call(this,{type:"media",message:c})):c instanceof vt&&((B=this.onmessage)==null||B.call(this,{type:"command",message:c}))}),o.on("failure",()=>{var c;(c=this.onmessage)==null||c.call(this,{type:"failure"})}),this.dongleDriver=o}clearPairTimeout(){this._pairTimeout&&(clearTimeout(this._pairTimeout),this._pairTimeout=null)}clearFrameInterval(){this._frameInterval&&(clearInterval(this._frameInterval),this._pairTimeout=null)}}class ze{constructor(s){w(this,"type","frame");this.frameData=s}}class Xe{static getStorageForCapacity(s,o){if(!o.BYTES_PER_ELEMENT)throw TypeError("Pass in a ArrayBuffer subclass");const c=8+(s+1)*o.BYTES_PER_ELEMENT;return new SharedArrayBuffer(c)}constructor(s,o){if(o.BYTES_PER_ELEMENT===void 0)throw TypeError("Pass a concrete typed array class as second argument");this._type=o,this._capacity=(s.byteLength-8)/o.BYTES_PER_ELEMENT,this.buf=s,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new o(this.buf,8,this._capacity)}type(){return this._type.name}push(s,o,c=0){const f=Atomics.load(this.read_ptr,0),d=Atomics.load(this.write_ptr,0);if((d+1)%this._storage_capacity()===f)return 0;const l=o!==void 0?o:s.length,u=Math.min(this._available_write(f,d),l),y=Math.min(this._storage_capacity()-d,u),B=u-y;return this._copy(s,c,this.storage,d,y),this._copy(s,c+y,this.storage,0,B),Atomics.store(this.write_ptr,0,(d+u)%this._storage_capacity()),u}writeCallback(s,o){const c=Atomics.load(this.read_ptr,0),f=Atomics.load(this.write_ptr,0);if((f+1)%this._storage_capacity()===c)return 0;const d=Math.min(this._available_write(c,f),s),l=Math.min(this._storage_capacity()-f,d),u=d-l,y=new this._type(this.storage.buffer,8+f*this.storage.BYTES_PER_ELEMENT,l),B=new this._type(this.storage.buffer,8+0,u),g=o(y,B)||d;return Atomics.store(this.write_ptr,0,(f+g)%this._storage_capacity()),g}writeCallbackWithOffset(s,o){const c=Atomics.load(this.read_ptr,0),f=Atomics.load(this.write_ptr,0);if((f+1)%this._storage_capacity()===c)return 0;const d=Math.min(this._available_write(c,f),s),l=Math.min(this._storage_capacity()-f,d),u=d-l,y=o(this.storage,f,l,0,u)||d;return Atomics.store(this.write_ptr,0,(f+y)%this._storage_capacity()),y}pop(s,o,c=0){const f=Atomics.load(this.read_ptr,0),d=Atomics.load(this.write_ptr,0);if(d===f)return 0;const l=o!==void 0?o:s.length,u=Math.min(this._available_read(f,d),l),y=Math.min(this._storage_capacity()-f,u),B=u-y;return this._copy(this.storage,f,s,c,y),this._copy(this.storage,0,s,c+y,B),Atomics.store(this.read_ptr,0,(f+u)%this._storage_capacity()),u}empty(){const s=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)===s}full(){const s=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this._storage_capacity()===s}capacity(){return this._capacity-1}availableRead(){const s=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);return this._available_read(s,o)}available_read(){return this.availableRead()}availableWrite(){const s=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);return this._available_write(s,o)}available_write(){return this.availableWrite()}_available_read(s,o){return(o+this._storage_capacity()-s)%this._storage_capacity()}_available_write(s,o){return this.capacity()-this._available_read(s,o)}_storage_capacity(){return this._capacity}_copy(s,o,c,f,d){for(let l=0;l<d;l++)c[f+l]=s[o+l]}}const Gt=(r,s)=>{const o=Ie[r];return[o.frequency,o.channel,s].join("_")};let S=null,yt=null,Yt=null,Et=null;const st={},X={},Je=r=>{const{type:s,message:o}=r;if(s==="video"&&yt)yt.postMessage(new ze(o.data),[o.data.buffer]);else if(s==="audio"&&o.data){const{decodeType:c,audioType:f}=o,d=Gt(c,f);if(st[d])st[d].push(o.data);else{X[d]||(X[d]=[]),X[d].push(o.data),o.data=void 0;const l={type:"getAudioPlayer",message:{...o}};postMessage(l)}}else postMessage(r)};onmessage=async r=>{switch(r.data.type){case"initialise":if(S)return;yt=r.data.payload.videoPort,Yt=r.data.payload.microphonePort,Yt.onmessage=l=>{if(S){const u=new Ue(l.data);S.dongleDriver.send(u)}};break;case"audioBuffer":const{sab:s,decodeType:o,audioType:c}=r.data.payload,f=Gt(o,c);st[f]=new Xe(s,Int16Array),X[f]&&(X[f].forEach(l=>{st[f].push(l)}),X[f]=[]);break;case"start":if(S)return;Et=r.data.payload.config;const d=await Ye();d&&(S=new Ke(Et),S.onmessage=Je,S.start(d));break;case"touch":if(Et&&S){const{x:l,y:u,action:y}=r.data.payload,B=new be(l,u,y);S.dongleDriver.send(B)}break;case"stop":await(S==null?void 0:S.stop()),S=null;break;case"frame":if(S){const l=new $("frame");S.dongleDriver.send(l)}break;case"keyCommand":if(S){const l=new $(r.data.command);S.dongleDriver.send(l)}}}})();
